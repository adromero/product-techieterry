---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import DecadeNav from '../../components/DecadeNav.astro';
import PostCard from '../../components/PostCard.astro';

export async function getStaticPaths() {
  const decades = ['1980s', '1990s', '2000s', '2010s', '2020s'];

  return decades.map((decade) => ({
    params: { decade },
  }));
}

const { decade } = Astro.params;

// Get all posts and filter by decade
const allPosts = await getCollection('posts');
const filteredPosts = allPosts
  .filter((post) => post.data.decade === decade)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

// Page metadata
const title = `${decade} - Techie Terry's Tech Blog`;
const description = `Browse all of Techie Terry's tech predictions and musings from the ${decade}.`;
---

<BaseLayout title={title} description={description}>
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <DecadeNav currentDecade={decade} />

    <header class="my-8 text-center">
      <h1 class="text-3xl md:text-4xl font-serif font-bold text-text mb-2">
        The {decade}
      </h1>
      <p class="text-text/70 font-serif">
        {filteredPosts.length} {filteredPosts.length === 1 ? 'post' : 'posts'} from this decade
      </p>
    </header>

    {filteredPosts.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {filteredPosts.map((post) => (
          <PostCard post={post} />
        ))}
      </div>
    ) : (
      <p class="text-center text-text/60 font-serif py-12">
        No posts from the {decade} yet. Check back soon!
      </p>
    )}
  </div>

  <Footer />
</BaseLayout>
